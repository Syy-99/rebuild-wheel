## Sleep

利用sleep系统调用，根据用户输入数字设置暂停的时间中断次数，并且如果用户没有设置则打印错误信息

### 实验步骤

1. 实现`user/sleep.c`：

2. 了解sleep系统调用流程：

    - `user/Usys.s`中提供了`sleep()`的汇编形式，它会保存一个系统调用号，并将CPU切换到特权模式

    - `kernel/syscall.c`中的`syscall()`根据系统调用号，调用相应的函数`sys_sleep()`， 注意此时已经在内核态了
    
        > 更多系统调用相关分析，参考Lab_2

3. 在Makefile文件内添加sleep目标文件

    ```sh
    UPROGS=\
	#...
	$U/_zombie\
	$U/_sleep\   # 添加这一行，一定是_sleep,而不能是sleep！
    ```

### 结果

```sh
$ sleep 10
$ sleep
no specified number of tricks
$ sleep 2 2
too many command argument
$ sleep 100 
```
- 编译时，显示`user/user.h`中`uint`出错，需要`typedef`一下

```sh
syy@syyhost:~/xv6-labs-2020$ ./grade-lab-util sleep
make: 'kernel/kernel' is up to date.
== Test sleep, no arguments == sleep, no arguments: OK (1.4s) 
== Test sleep, returns == sleep, returns: OK (0.7s) 
== Test sleep, makes syscall == sleep, makes syscall: OK (1.1s) 
```

## pingpong 

父子进程利用管道通信：

- 父进程首先发送1字节后，子进程接收，并打印PID信息, 然后发送1字节

- 父进程接收后，打印PID信息

## 实验步骤

1. 实现`user/pingpong.c`:
    ```c
    #include "user/user.h"

    int main() {
        int fd[2];
        pipe(fd);

        if (fork() > 0) { // 在父进程中
            write(fd[1], "!", 1);
            
            char buf;
            read(fd[0], &buf, 1);
            printf("<%d>: received pong", getpid());	
        } else if (fork() == 0) {
            char buf;
            read(fd[0], &buf, 1);			// 因为父进程拥有fd[1], 因此当还没有数据时，read()会阻塞
            printf("<%d>: received ping", getpid());

            write(fd[1], "!", 1);
        } else {
            prinf("fork() error\n");
            return -1;
        }
    }
    ```
2. 在Makefile文件内添加pingpong目标文件

    ```
    $U/_sleep\
    $U/_pingpong\
    ```
### 结果

```
xv6 kernel is booting

hart 1 starting
hart 2 starting
init: starting sh
$ pingpong
5: received ping
3: received pong
$ QEMU: Terminated
syy@syyhost:~/xv6-labs-2020$ ./grade-lab-util pingpong
make: 'kernel/kernel' is up to date.
== Test pingpong == pingpong: OK (0.7s) 
```

- 为什们子进程的pid=5而不是3呢?

    ```sh
    # 消除pingpong.c的else部分
    $ pingpong
    fork() error 4    # ??? why?
    5: received ping
    3: received pong
    ```

## primes 

- 利用[筛法](https://swtch.com/~rsc/thread/)，获得[2,32]之间的所有素数